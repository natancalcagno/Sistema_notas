{% extends 'base.html' %}

{% block title %}Lista de Notas{% endblock %}

{% block head %}
    {{ block.super }}
{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
    <h1>Notas Fiscais</h1>
    <a href="{% url 'nova_nota' %}" class="btn btn-success">Nova Nota</a>
</div>

{% if notas %}
<div class="table-responsive">
    <table class="table table-striped table-hover">
        <thead class="bg-dark text-white">
            <tr>
                <th>Data de Entrada</th>
                <th>Empenho</th>
                <th>Empresa</th>
                <th>Setor</th>
                <th>Número da Nota</th>
                <th>Data da Nota</th>
                <th>Valor</th>
                <th>Data de Saída</th>
                <th>Observações</th>
                <th>Ações</th>
            </tr>
        </thead>
        <tbody>
            {% for nota in notas %}
            <tr>
                <td>{{ nota.data_entrada|date:"d/m/Y" }}</td>
                <td>{{ nota.empenho }}</td>
                <td>{{ nota.empresa }}</td>
                <td>{{ nota.setor }}</td>
                <td>{{ nota.numero }}</td>
                <td>{{ nota.data_nota|date:"d/m/Y" }}</td>
                <td>R$ {{ nota.valor|floatformat:2 }}</td>
                <td>{{ nota.data_saida|date:"d/m/Y" }}</td>
                <td>
                    {% if nota.observacoes %}
                    <button type="button" class="btn btn-sm btn-info" data-bs-toggle="modal" data-bs-target="#observacoesModal" data-bs-content="{{ nota.observacoes }}">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-eye-fill" viewBox="0 0 16 16">
                            <path d="M10.5 8a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0z"/>
                            <path d="M0 8s3-5.5 8-5.5S16 8 16 8s-3 5.5-8 5.5S0 8 0 8zm8 3.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7z"/>
                        </svg>
                    </button>
                    {% else %}
                    -
                    {% endif %}
                </td>
                <td>
                    <a href="{% url 'editar_nota' nota.pk %}" class="btn btn-sm btn-primary">Editar</a>
                    <a href="{% url 'excluir_nota' nota.pk %}" class="btn btn-sm btn-danger">Excluir</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<nav aria-label="Page navigation">
    <ul class="pagination justify-content-center">
        {% if page_obj.has_previous %}
        <li class="page-item"><a class="page-link" href="?page={{ page_obj.previous_page_number }}">Anterior</a></li>
        {% endif %}
        <li class="page-item disabled"><span class="page-link">Página {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}</span></li>
        {% if page_obj.has_next %}
        <li class="page-item"><a class="page-link" href="?page={{ page_obj.next_page_number }}">Próxima</a></li>
        {% endif %}
    </ul>
</nav>

{% else %}
<p class="text-center">Nenhuma nota cadastrada.</p>
{% endif %}

<!-- Modal para Observações -->
<div class="modal fade" id="observacoesModal" tabindex="-1" aria-labelledby="observacoesModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title" id="observacoesModalLabel">Observações da Nota</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p id="modal-observacoes-text"></p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    var observacoesModal = document.getElementById('observacoesModal');
    observacoesModal.addEventListener('show.bs.modal', function(event) {
        var button = event.relatedTarget;
        var observacoes = button.getAttribute('data-bs-content');
        var modalBody = observacoesModal.querySelector('#modal-observacoes-text');
        modalBody.textContent = observacoes;
    });
});
</script>

{% endblock %}
